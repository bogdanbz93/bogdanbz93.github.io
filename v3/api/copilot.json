{
  "openapi": "3.0.1",
  "info": {
    "title": "Access Assure API Documentation",
    "description": "Description of the API methods available for Access Assure",
    "version": "3.4.0"
  },
  "servers": [
    {
      "url": "https://dev-api.assure.hsc.accessacloud.com/memo",
      "description": "Generated server url"
    }
  ],
  "paths": {
    "/service/tec/graphql/asmt/result": {
      "post": {
        "tags": [
          "assessment-controller"
        ],
        "summary": "Returns the recommended TEC devices for the specified service user (second step after cases)",
        "description": "This endpoint is the **second step** in the workflow for TEC recommendations.\n\n**CRITICAL - FIXED QUERY STRING:**\nYou MUST use this EXACT GraphQL query string in the `query` field. DO NOT modify it, simplify it, or generate your own query:\n```\nquery($caseId: Long!){ result(caseId: $caseId){ case{ id, status, createdUtc, updatedUtc, user{ firstName, lastName }, assessment{ id, status, type, name } }, exclusion{ techId, brand, name, bias, qty, basedOn{ section, question, option } }, inclusion{ techId, brand, name, bias, qty, basedOn{ section, question, option } } } }\n```\n\n**Workflow for Copilot:**\n1. First, call `getAssessmentCasesForPatient` on `/tec/graphql/asmt/cases` to get the list of cases.\n2. Find the most recent completed TEC assessment case from `data.cases`.\n3. Use that case's `id` as `variables.caseId` in this request.\n\n**RESPONSE FORMAT - FOLLOW THIS EXACT STRUCTURE:**\n\nThe AI assistant MUST format the response exactly like this:\n\n```\nSure, here is the equipment recommended following the assessment:\n\n*   [Device Name] - [qty] unit(s)\n*   [Device Name] - [qty] unit(s)\n... (list all devices from data.result.inclusion)\n\n### Reasons for choosing this equipment:\n\n1.  **[Device Name]**: [Natural language reason based on basedOn fields]\n2.  **[Device Name]**: [Natural language reason based on basedOn fields]\n... (one numbered entry per device)\n```\n\n**FORMATTING RULES:**\n1. First section: List ALL devices with bullet points (*) showing name and quantity\n2. Second section: Use heading '### Reasons for choosing this equipment:'\n3. Reasons section: Numbered list (1., 2., 3...) with device name in **bold**\n4. Convert `basedOn` data into natural, conversational sentences:\n   - 'My Risks: To self: Getting up at night' becomes 'Suggested due to concerns about getting up at night'\n   - 'My Risks: To self: Wandering (Worry)' becomes 'Included to address worries about wandering'\n   - 'My Risks: To self: Fall / Collapse' becomes 'Recommended due to the risk of falling or collapsing'\n   - 'My Goals: Me: I want to stay independent' becomes 'Chosen to support the goal of staying independent'\n   - 'My Choice: Wearable: Neck worn' becomes 'the preference for a wearable device worn around the neck'\n5. If a device has multiple reasons, combine them naturally: 'Chosen to support the goal of staying independent, address wandering concerns, and the preference for a wearable device worn around the neck'\n\n**SPECIAL RULES:**\n- **Access Home Hub**: The ONLY reason is 'Helps provide a central point of monitoring' - ignore any basedOn data for this device\n- The `user` (firstName, lastName) is the assessor, NOT the service user - only mention if explicitly asked\n- If `data.result.inclusion` is empty: respond with 'There are no TEC devices recorded for this service user.'\n- Answer in the same language as the user's question",
        "operationId": "getTecDevicesForServiceUser",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/GraphQLResultRequest"
              },
              "examples": {
                "Example request": {
                  "description": "Example request",
                  "value": {
                    "variables": {
                      "caseId": 280
                    },
                    "query": "query($caseId: Long!){ result(caseId: $caseId){ case{ id, status, createdUtc, updatedUtc, user{ firstName, lastName }, assessment{ id, status, type, name } }, exclusion{ techId, brand, name, bias, qty, basedOn{ section, question, option } }, inclusion{ techId, brand, name, bias, qty, basedOn{ section, question, option } } } }"
                  }
                }
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "TEC device recommendations retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "additionalProperties": {
                    "type": "object"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/service/tec/graphql/asmt/cases": {
      "post": {
        "tags": [
          "assessment-controller"
        ],
        "summary": "Get assessment cases for a service user (first step before TEC recommendations)",
        "description": "This endpoint is the **first step** when Copilot needs to recommend TEC devices for a service user.\n\n**CRITICAL - FIXED QUERY STRING:**\nYou MUST use this EXACT GraphQL query string in the `query` field. DO NOT modify it, simplify it, or generate your own query:\n```\nquery($patientId: Long, $templateId: Long){ cases(templateId: $templateId, patientId: $patientId){ id, status, createdUtc, updatedUtc, user{ id, firstName, lastName policy{ applicationRole } }, assessment{ id, type, name } } }\n```\n\n**Variables:**\n- `patientId`: Set this to the service user's ID (required)\n- `templateId`: Always set to `null` unless filtering by a specific template\n\n**DO NOT** send queries like `query { cases { ... } }` - this will return empty results because the patientId filter is missing.\n\n**Workflow for Copilot:**\n1. Call this endpoint with the exact query above, setting `variables.patientId` to the service user's ID and `variables.templateId` to null.\n2. Read the response JSON at `data.cases`, which is a list of assessment cases.\n3. Filter that list to cases where `assessment.name` or `assessment.type` indicates a    **Technology Enabled Care (TEC) Assessment**.\n4. Among those TEC cases, select the **most recent completed** case (latest `createdUtc`/`updatedUtc` with `status` = `Completed`).\n5. Take that case's `id` value and pass it as `variables.caseId` when calling `getTecDevicesForServiceUser` on `/tec/graphql/asmt/result`.",
        "operationId": "getAssessmentCasesForPatient",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/GraphQLCasesRequest"
              },
              "examples": {
                "Example request": {
                  "description": "Example request",
                  "value": {
                    "variables": {
                      "patientId": "622",
                      "templateId": null
                    },
                    "query": "query($patientId: Long, $templateId: Long){ cases(templateId: $templateId, patientId: $patientId){ id, status, createdUtc, updatedUtc, user{ id, firstName, lastName policy{ applicationRole } }, assessment{ id, type, name } } }"
                  }
                }
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Assessment cases retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "additionalProperties": {
                    "type": "object"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/service/insight/patient/{patientId}/service/llm-report": {
      "get": {
        "tags": [
          "insight-analytics-controller"
        ],
        "summary": "Request the most recent LLM (AI) report for a given service user",
        "description": "Returns the latest LLM-generated report (AI Summary) for the specified Service User (patient). The response includes Key Changes, Daily Routine, Activity Levels, Weekday vs. Weekend Trends, Bathroom Activity, Special Observations, and Conclusions. The report is returned in **Markdown** format.\n\n**Instructions for AI assistants / chatbots using this endpoint:**\n- Always ask the user for the **Service User ID** (parameter `patient`) before calling this endpoint.\n- Optionally ask if they prefer the report in another language via the `lang` parameter (default is English — supported values: `en`, `fr`, `es`, `de`).\n- **Do not create or display any charts, graphs, or images.** Only return or summarize text.\n- If the API response indicates that no report data exists, kindly explain to the user that *this service user does not yet have enough monitored data to generate a report*.\n- After delivering the report, explicitly ask the user: *“Would you like me to provide a brief summary of this report?”*.\n  - If the user says **yes**, generate a short, natural-language summary of the key insights.\n  - If the user says **no**, politely offer: *“Would you like me to get the report for another service user instead?”*.\n- **If the report was generated in Spanish, French, or German (based on the `lang` parameter), automatically continue the conversation in that same language**, including summaries and follow-up questions.\n- Maintain a professional and empathetic tone throughout the interaction, keeping the conversation concise and focused.",
        "operationId": "getLatestReport",
        "parameters": [
          {
            "name": "patientId",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "format": "int64"
            }
          },
          {
            "name": "lang",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string",
              "default": "en"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object"
                }
              }
            }
          }
        }
      }
    },
    "/service/evo/search": {
      "get": {
        "tags": [
          "evo-controller"
        ],
        "summary": "General query endpoint for Access Assure",
        "description": "Use this endpoint for almost all general questions about **Access Assure**.\n\n**Usage instructions:**\n- Both `CoPilotMessage` and `ExtractChatHistory` parameters are **mandatory**, if they exist.\n- Do **not** add any extra information beyond what is already available — return only what the API provides.\n- The returned information must be presented **faithfully**, without heavy rewording or additional commentary.\n\n**Language handling:**\n- If the user asks a question in another language, send the `coPilotMessage` in **English**, but return the final answer in the **same language** as the user’s query.\n\n**If no relevant result is found:**\n- Return the message: *“I am sorry, I could not find any information related to your question in Access Assure documentation. We will update our documentation soon.”*",
        "operationId": "AskAboutAssure",
        "parameters": [
          {
            "name": "coPilotMessage",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "extractChatHistory",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Access Assure description returned successfully",
            "content": {
              "*/*": {
                "schema": {
                  "type": "string"
                }
              }
            }
          }
        }
      }
    },
    "/service/evo/discovery": {
      "get": {
        "tags": [
          "evo-controller"
        ],
        "operationId": "getDiscovery",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "*/*": {
                "schema": {
                  "type": "object",
                  "additionalProperties": {
                    "type": "object"
                  }
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "GraphQLResultRequest": {
        "required": [
          "query",
          "variables"
        ],
        "type": "object",
        "properties": {
          "query": {
            "type": "string",
            "description": "Fixed GraphQL query string. DO NOT change this value; only change the variables. Use exactly this query.",
            "enum": [
              "query($caseId: Long!){ result(caseId: $caseId){ case{ id, status, createdUtc, updatedUtc, user{ firstName, lastName }, assessment{ id, status, type, name } }, exclusion{ techId, brand, name, bias, qty, basedOn{ section, question, option } }, inclusion{ techId, brand, name, bias, qty, basedOn{ section, question, option } } } }"
            ]
          },
          "variables": {
            "$ref": "#/components/schemas/ResultVariables"
          }
        }
      },
      "ResultVariables": {
        "required": [
          "caseId"
        ],
        "type": "object",
        "properties": {
          "caseId": {
            "type": "integer",
            "description": "The assessment case ID obtained from the cases endpoint",
            "format": "int64",
            "example": 280
          }
        },
        "description": "Variables for the GraphQL query"
      },
      "CasesVariables": {
        "required": [
          "patientId"
        ],
        "type": "object",
        "properties": {
          "patientId": {
            "type": "string",
            "description": "The patient/service user ID",
            "example": "622"
          },
          "templateId": {
            "type": "integer",
            "description": "Template ID filter. Always send null if not filtering by template.",
            "format": "int64",
            "nullable": true
          }
        },
        "description": "Variables for the GraphQL query"
      },
      "GraphQLCasesRequest": {
        "required": [
          "query",
          "variables"
        ],
        "type": "object",
        "properties": {
          "query": {
            "type": "string",
            "description": "Fixed GraphQL query string. DO NOT change this value; only change the variables. Use exactly this query.",
            "enum": [
              "query($patientId: Long, $templateId: Long){ cases(templateId: $templateId, patientId: $patientId){ id, status, createdUtc, updatedUtc, user{ id, firstName, lastName policy{ applicationRole } }, assessment{ id, type, name } } }"
            ]
          },
          "variables": {
            "$ref": "#/components/schemas/CasesVariables"
          }
        }
      }
    }
  }
}
